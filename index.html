<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker Local</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            font-size: clamp(14px, 2.5vw, 16px);
        }
        html {
            /* –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
            font-size: clamp(14px, 1vw + 12px, 16px);
        }
        button {
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
            font-size: clamp(12px, 2vw, 14px);
        }
        h1 {
            font-size: clamp(18px, 4vw, 24px);
        }
        h2 {
            font-size: clamp(20px, 5vw, 32px);
        }
        .habit-name {
            font-size: clamp(14px, 3vw, 16px);
        }
    </style>
    <script>
        // –°–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ Tailwind CDN
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0]?.includes?.('cdn.tailwindcss.com')) return;
            originalWarn.apply(console, args);
        };
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Plus = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const X = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Check = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const Trash2 = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const Download = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const Upload = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const Settings = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>;
        const HelpCircle = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const Sun = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>;
        const Moon = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>;
        const Calendar = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const Target = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;

        // LocalStorage utilities
        const saveToLocal = (key, data) => {
            localStorage.setItem(key, JSON.stringify(data));
        };

        const loadFromLocal = (key, defaultValue = null) => {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        };

        function HabitTracker() {
            const [habits, setHabits] = useState([]);
            const [isDark, setIsDark] = useState(true);
            const [showAddForm, setShowAddForm] = useState(false);
            const [expandedHabit, setExpandedHabit] = useState(null);
            const [confirmDelete, setConfirmDelete] = useState(null);
            const [showCompletionModal, setShowCompletionModal] = useState(null);
            const [completionValue, setCompletionValue] = useState(1);
            const [showSettings, setShowSettings] = useState(false);
            const [showHelp, setShowHelp] = useState(false);
            const [showFirstTimeModal, setShowFirstTimeModal] = useState(false);
            const [editingHabit, setEditingHabit] = useState(null);
            const [editForm, setEditForm] = useState({
                name: '',
                category: '–£—á—ë–±–∞',
                color: '#667eea',
                metricType: 'check',
                targetValue: 1,
                unit: '',
                frequency: 'daily',
                selectedDays: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
            });
            
            const [settings, setSettings] = useState({
                // –£–±—Ä–∞–ª–∏ Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            });
            
            const [newHabit, setNewHabit] = useState({
                name: '',
                category: '–£—á—ë–±–∞',
                color: '#667eea',
                metricType: 'check',
                targetValue: 1,
                unit: '',
                frequency: 'daily',
                selectedDays: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
            });

            const categories = ['–£—á—ë–±–∞', '–ó–¥–æ—Ä–æ–≤—å–µ', '–°–ø–æ—Ä—Ç', '–†–∞–±–æ—Ç–∞', '–õ–∏—á–Ω–æ–µ'];
            const categoryIcons = { '–£—á—ë–±–∞': 'üìö', '–ó–¥–æ—Ä–æ–≤—å–µ': 'üçé', '–°–ø–æ—Ä—Ç': 'üí™', '–†–∞–±–æ—Ç–∞': 'üíº', '–õ–∏—á–Ω–æ–µ': '‚ú®' };
            const habitColors = [
                { name: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π', value: '#667eea' },
                { name: '–°–∏–Ω–∏–π', value: '#4299e1' },
                { name: '–ó–µ–ª—ë–Ω—ã–π', value: '#48bb78' },
                { name: '–û—Ä–∞–Ω–∂–µ–≤—ã–π', value: '#ed8936' },
                { name: '–†–æ–∑–æ–≤—ã–π', value: '#ed64a6' },
                { name: '–ö—Ä–∞—Å–Ω—ã–π', value: '#f56565' }
            ];
            const weekDays = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];

            // Load data on mount
            useEffect(() => {
                const savedHabits = loadFromLocal('habits', []);
                const isFirstTime = loadFromLocal('isFirstTime', true);
                
                setHabits(savedHabits);
                
                if (isFirstTime) {
                    setShowFirstTimeModal(true);
                    saveToLocal('isFirstTime', false);
                }
            }, []);

            // Save habits when changed
            useEffect(() => {
                if (habits.length > 0) {
                    saveToLocal('habits', habits);
                }
            }, [habits]);

            const exportData = () => {
                try {
                    const data = {
                        habits: habits || [],
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };
                    
                    const fileName = `habit-tracker-${new Date().toISOString().split('T')[0]}.json`;
                    const jsonStr = JSON.stringify(data, null, 2);
                    
                    // –ü—Ä–æ—Å—Ç–æ–π data URL –ø–æ–¥—Ö–æ–¥ - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
                    const dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonStr);
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = fileName;
                    link.click();
                    
                    setTimeout(() => {
                        alert(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω!\n\n–§–∞–π–ª: ${fileName}\n\nüìÇ –ì–¥–µ –∏—Å–∫–∞—Ç—å:\n–§–∞–π–ª—ã ‚Üí –ó–∞–≥—Ä—É–∑–∫–∏\n–∏–ª–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö`);
                    }, 300);
                    
                } catch (err) {
                    console.error('Export error:', err);
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
                }
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        console.log('Importing data:', data);
                        
                        if (data.habits) {
                            setHabits(data.habits);
                            saveToLocal('habits', data.habits);
                            alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        } else {
                            alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    } catch (err) {
                        console.error('Import error:', err);
                        alert('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message);
                    }
                };
                reader.onerror = () => {
                    alert('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                };
                reader.readAsText(file);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
                event.target.value = '';
            };

            const getUnitLabel = (habit) => {
                if (habit.metricType === 'check') return '';
                if (habit.metricType === 'count') return habit.unit || '—Ä–∞–∑';
                if (habit.metricType === 'time') return '–º–∏–Ω';
                if (habit.metricType === 'distance') return '–∫–º';
                return '';
            };

            const addHabit = () => {
                if (!newHabit.name.trim()) return;
                const habit = {
                    ...newHabit,
                    id: Date.now(),
                    completedDates: [],
                    createdAt: new Date().toISOString()
                };
                setHabits([...habits, habit]);
                setNewHabit({ name: '', category: '–£—á—ë–±–∞', color: '#667eea', metricType: 'check', targetValue: 1, unit: '', frequency: 'daily', selectedDays: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'] });
                setShowAddForm(false);
            };

            const deleteHabit = () => {
                setHabits(habits.filter(h => h.id !== confirmDelete));
                setConfirmDelete(null);
            };

            const openEditModal = (habit) => {
                setEditingHabit(habit.id);
                setEditForm({
                    name: habit.name,
                    category: habit.category,
                    color: habit.color,
                    metricType: habit.metricType,
                    targetValue: habit.targetValue,
                    unit: habit.unit || '',
                    frequency: habit.frequency,
                    selectedDays: habit.selectedDays || ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
                });
            };

            const saveEditHabit = () => {
                if (!editForm.name.trim()) return;
                setHabits(habits.map(h => 
                    h.id === editingHabit 
                        ? { ...h, ...editForm }
                        : h
                ));
                setEditingHabit(null);
            };

            const toggleEditDay = (day) => {
                const days = editForm.selectedDays;
                if (days.includes(day)) {
                    setEditForm({...editForm, selectedDays: days.filter(d => d !== day)});
                } else {
                    setEditForm({...editForm, selectedDays: [...days, day]});
                }
            };

            const openCompletionModal = (habit) => {
                setShowCompletionModal(habit);
                setCompletionValue(habit.targetValue || 1);
            };

            const completeHabit = () => {
                if (!showCompletionModal) return;
                const habit = showCompletionModal;
                const now = new Date();
                const dateStr = now.toDateString();
                
                const completionData = {
                    date: dateStr,
                    value: completionValue,
                    timestamp: now.toISOString(),
                    time: now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    percentage: Math.round((completionValue / habit.targetValue) * 100)
                };

                setHabits(habits.map(h => {
                    if (h.id !== habit.id) return h;
                    const completions = h.completedDates || [];
                    const todayIndex = completions.findIndex(c => c.date === dateStr);
                    if (todayIndex >= 0) {
                        completions[todayIndex] = completionData;
                    } else {
                        completions.push(completionData);
                    }
                    return { ...h, completedDates: completions };
                }));
                
                setShowCompletionModal(null);
                setCompletionValue(1);
            };

            const cancelCompletion = (habitId) => {
                const dateStr = new Date().toDateString();
                setHabits(habits.map(h => {
                    if (h.id !== habitId) return h;
                    const completions = (h.completedDates || []).filter(c => c.date !== dateStr);
                    return { ...h, completedDates: completions };
                }));
            };

            const getTodayCompletion = (habit) => {
                const today = new Date().toDateString();
                return (habit.completedDates || []).find(c => c.date === today);
            };

            const getCompletionOnDate = (habit, date) => {
                return (habit.completedDates || []).find(c => c.date === date.toDateString());
            };

            const getCurrentMonthDays = () => {
                const now = new Date();
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const days = [];
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(now.getFullYear(), now.getMonth(), day));
                }
                return days;
            };

            const toggleDay = (day) => {
                const days = newHabit.selectedDays;
                if (days.includes(day)) {
                    setNewHabit({...newHabit, selectedDays: days.filter(d => d !== day)});
                } else {
                    setNewHabit({...newHabit, selectedDays: [...days, day]});
                }
            };

            const monthDays = getCurrentMonthDays();

            return (
                <div className={`min-h-screen ${isDark ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`}>
                    {/* Header */}
                    <header className={`${isDark ? 'bg-gray-800' : 'bg-white'} shadow-lg sticky top-0 z-50`}>
                        <div className="px-3 sm:px-4 py-3 sm:py-4 flex items-center justify-between">
                            <h1 className="text-lg sm:text-xl font-bold">üìä Habit Tracker</h1>
                            <div className="flex items-center gap-1.5 sm:gap-3">
                                <button onClick={() => setShowHelp(true)} className={`p-2 sm:p-3 rounded-xl ${isDark ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`}>
                                    <div className="w-5 h-5 sm:w-6 sm:h-6"><HelpCircle /></div>
                                </button>
                                <button onClick={() => setShowSettings(true)} className={`p-2 sm:p-3 rounded-xl ${isDark ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`}>
                                    <div className="w-5 h-5 sm:w-6 sm:h-6"><Settings /></div>
                                </button>
                                <button onClick={() => setIsDark(!isDark)} className={`p-2 sm:p-3 rounded-xl ${isDark ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`}>
                                    <div className="w-5 h-5 sm:w-6 sm:h-6">{isDark ? <Sun /> : <Moon />}</div>
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* First Time Modal */}
                    {showFirstTimeModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-md w-full`}>
                                <h2 className="text-2xl font-bold mb-4">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                                <div className="space-y-3 text-sm mb-6">
                                    <p>üíæ <strong>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</strong></p>
                                    <p>‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</p>
                                    <p>‚úÖ <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–≠–∫—Å–ø–æ—Ä—Ç" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</p>
                                </div>
                                <button onClick={() => setShowFirstTimeModal(false)} className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-xl font-medium">
                                    –ü–æ–Ω—è—Ç–Ω–æ!
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4 overflow-y-auto">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-md w-full my-8`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                                    <button onClick={() => setShowSettings(false)} className="p-2"><div className="w-6 h-6"><X /></div></button>
                                </div>

                                <div className="space-y-4">
                                    {/* Export/Import */}
                                    <div>
                                        <h4 className="font-bold mb-2 flex items-center gap-2"><Download /> –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</h4>
                                        <div className="flex gap-2">
                                            <button onClick={exportData} className="flex-1 bg-blue-600 py-3 rounded-xl flex items-center justify-center gap-2 text-white">
                                                <div className="w-5 h-5"><Download /></div>
                                                <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                                            </button>
                                            <label className="flex-1 bg-green-600 py-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer text-white">
                                                <div className="w-5 h-5"><Upload /></div>
                                                <span>–ò–º–ø–æ—Ä—Ç</span>
                                                <input type="file" accept=".json" onChange={importData} className="hidden" />
                                            </label>
                                        </div>
                                        <p className="text-xs text-gray-400 mt-2">
                                            üí° <strong>–≠–∫—Å–ø–æ—Ä—Ç:</strong> —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É –ó–∞–≥—Ä—É–∑–∫–∏<br/>
                                            üìÇ <strong>–ù–∞–π—Ç–∏:</strong> –§–∞–π–ª—ã ‚Üí –ó–∞–≥—Ä—É–∑–∫–∏ ‚Üí habit-tracker-backup-–ì–ì–ì–ì-–ú–ú-–î–î.json
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Help Modal */}
                    {showHelp && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4 overflow-y-auto">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-md w-full my-8`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-bold">‚ùì –ü–æ–º–æ—â—å</h3>
                                    <button onClick={() => setShowHelp(false)} className="p-2"><div className="w-6 h-6"><X /></div></button>
                                </div>

                                <div className="space-y-4 text-sm">
                                    <div>
                                        <h4 className="font-bold mb-2">üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                                        <div className="space-y-2 text-gray-400">
                                            <p className="font-semibold text-white">–≠–∫—Å–ø–æ—Ä—Ç:</p>
                                            <ol className="list-decimal list-inside space-y-1 ml-2">
                                                <li>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–≠–∫—Å–ø–æ—Ä—Ç"</li>
                                                <li>–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–ø–∫—É <strong>–ó–∞–≥—Ä—É–∑–∫–∏</strong></li>
                                                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ</li>
                                                <li>–ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –≤: –§–∞–π–ª—ã ‚Üí –ó–∞–≥—Ä—É–∑–∫–∏</li>
                                            </ol>
                                            <p className="font-semibold text-white mt-3">–ò–º–ø–æ—Ä—Ç:</p>
                                            <ol className="list-decimal list-inside space-y-1 ml-2">
                                                <li>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–ò–º–ø–æ—Ä—Ç"</li>
                                                <li>–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª –∏–∑ –ó–∞–≥—Ä—É–∑–æ–∫</li>
                                                <li>–î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è</li>
                                            </ol>
                                            <p className="text-xs mt-2">‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏!</p>
                                        </div>
                                    </div>

                                    <div>
                                        <h4 className="font-bold mb-2">üìä –¢–∏–ø—ã –º–µ—Ç—Ä–∏–∫</h4>
                                        <ul className="space-y-1 text-gray-400">
                                            <li>‚úì <strong>–ì–∞–ª–æ—á–∫–∞</strong> - –ø—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—Ç–∏—Ç—å</li>
                                            <li>üî¢ <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</strong> - —Å—á–µ—Ç—á–∏–∫ (—Å—Ç–∞–∫–∞–Ω—ã, –æ—Ç–∂–∏–º–∞–Ω–∏—è)</li>
                                            <li>‚è±Ô∏è <strong>–í—Ä–µ–º—è</strong> - –≤ –º–∏–Ω—É—Ç–∞—Ö</li>
                                            <li>üìè <strong>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</strong> - –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö</li>
                                        </ul>
                                    </div>

                                    <div>
                                        <h4 className="font-bold mb-2">üìÖ –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</h4>
                                        <ul className="space-y-1 text-gray-400">
                                            <li><strong>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</strong> - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</li>
                                            <li><strong>–í—ã–±—Ä–∞—Ç—å –¥–Ω–∏</strong> - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Other modals (Completion, Delete, Add Form) - same as before */}
                    {showCompletionModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 w-full max-w-md`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-bold">–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                                    <button onClick={() => setShowCompletionModal(null)} className="p-2"><div className="w-6 h-6"><X /></div></button>
                                </div>

                                <div className="mb-4">
                                    <div className="flex items-center gap-3 mb-3">
                                        <span className="text-3xl">{categoryIcons[showCompletionModal.category]}</span>
                                        <div>
                                            <h4 className="font-bold">{showCompletionModal.name}</h4>
                                            <p className="text-sm text-gray-400">
                                                {showCompletionModal.metricType !== 'check' && 
                                                    `–¶–µ–ª—å: ${showCompletionModal.targetValue} ${getUnitLabel(showCompletionModal)}`
                                                }
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {showCompletionModal.metricType === 'check' ? (
                                    <button onClick={completeHabit} className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-medium text-base">
                                        <div className="flex items-center justify-center gap-2"><Check />–í—ã–ø–æ–ª–Ω–µ–Ω–æ!</div>
                                    </button>
                                ) : (
                                    <>
                                        <div className="mb-4">
                                            <input 
                                                type="number" 
                                                value={completionValue}
                                                onChange={(e) => setCompletionValue(Number(e.target.value))}
                                                min="0"
                                                className={`w-full ${isDark ? 'bg-gray-700' : 'bg-gray-100'} text-center text-2xl font-bold px-4 py-3 rounded-xl outline-none`}
                                            />
                                        </div>
                                        <div className="grid grid-cols-3 gap-2 mb-4">
                                            <button onClick={() => setCompletionValue(Math.floor(showCompletionModal.targetValue / 2))} className={`${isDark ? 'bg-gray-700' : 'bg-gray-200'} py-2 rounded-lg text-sm`}>–ü–æ–ª–æ–≤–∏–Ω–∞</button>
                                            <button onClick={() => setCompletionValue(showCompletionModal.targetValue)} className="bg-blue-600 py-2 rounded-lg text-sm text-white">–¶–µ–ª—å</button>
                                            <button onClick={() => setCompletionValue(Math.floor(showCompletionModal.targetValue * 1.5))} className="bg-green-600 py-2 rounded-lg text-sm text-white">–ë–æ–ª—å—à–µ</button>
                                        </div>
                                        <button onClick={completeHabit} className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-medium text-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {confirmDelete && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 w-full max-w-sm`}>
                                <h2 className="text-xl font-bold mb-2">–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É?</h2>
                                <p className="text-gray-400 mb-6">{habits.find(h => h.id === confirmDelete)?.name}</p>
                                <div className="flex gap-3">
                                    <button onClick={deleteHabit} className="flex-1 bg-red-500 text-white py-3 rounded-xl font-medium">–£–¥–∞–ª–∏—Ç—å</button>
                                    <button onClick={() => setConfirmDelete(null)} className={`flex-1 ${isDark ? 'bg-gray-700' : 'bg-gray-200'} py-3 rounded-xl font-medium`}>–û—Ç–º–µ–Ω–∞</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Habit Modal - –∫–æ–ø–∏—è Add Form –Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}
                    {editingHabit && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-[100]">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-t-3xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-bold">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h3>
                                    <button onClick={() => setEditingHabit(null)} className="p-2"><div className="w-6 h-6"><X /></div></button>
                                </div>

                                <input type="text" value={editForm.name} onChange={(e) => setEditForm({...editForm, name: e.target.value})} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏" className={`w-full px-4 py-3 rounded-xl mb-4 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} />
                                <select value={editForm.category} onChange={(e) => setEditForm({...editForm, category: e.target.value})} className={`w-full px-4 py-3 rounded-xl mb-4 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`}>
                                    {categories.map(cat => <option key={cat} value={cat}>{categoryIcons[cat]} {cat}</option>)}
                                </select>

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏ *</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {[
                                            {type: 'check', icon: '‚úì', label: '–ì–∞–ª–æ—á–∫–∞', value: 1},
                                            {type: 'count', icon: 'üî¢', label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', value: 8},
                                            {type: 'time', icon: '‚è±Ô∏è', label: '–í—Ä–µ–º—è (–º–∏–Ω)', value: 30},
                                            {type: 'distance', icon: 'üìè', label: '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)', value: 5}
                                        ].map(m => (
                                            <button key={m.type} type="button" onClick={() => setEditForm({...editForm, metricType: m.type, targetValue: m.value})} className={`p-3 rounded-xl text-center transition-all ${editForm.metricType === m.type ? 'bg-slate-600 ring-2 ring-slate-400' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                                <div className="text-2xl mb-1">{m.icon}</div><div className="text-sm">{m.label}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {editForm.metricType !== 'check' && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                        <input type="number" value={editForm.targetValue} onChange={(e) => setEditForm({...editForm, targetValue: Number(e.target.value)})} min="1" className={`w-full px-4 py-3 rounded-xl ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} />
                                        {editForm.metricType === 'count' && (
                                            <input type="text" value={editForm.unit} onChange={(e) => setEditForm({...editForm, unit: e.target.value})} placeholder="–ï–¥–∏–Ω–∏—Ü–∞ (—Å—Ç–∞–∫–∞–Ω–æ–≤, —Ä–∞–∑...)" className={`w-full px-4 py-3 rounded-xl mt-2 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} />
                                        )}
                                    </div>
                                )}

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ *</label>
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setEditForm({...editForm, frequency: 'daily', selectedDays: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']})} className={`flex-1 py-3 rounded-xl transition-all ${editForm.frequency === 'daily' ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</button>
                                        <button type="button" onClick={() => setEditForm({...editForm, frequency: 'weekly'})} className={`flex-1 py-3 rounded-xl transition-all ${editForm.frequency === 'weekly' ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>–í—ã–±—Ä–∞—Ç—å –¥–Ω–∏</button>
                                    </div>
                                </div>

                                {editForm.frequency === 'weekly' && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">–î–Ω–∏ –Ω–µ–¥–µ–ª–∏</label>
                                        <div className="flex gap-2">
                                            {weekDays.map(day => (
                                                <button key={day} type="button" onClick={() => toggleEditDay(day)} className={`flex-1 py-2 rounded-lg transition-all ${editForm.selectedDays.includes(day) ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>{day}</button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–¶–≤–µ—Ç</label>
                                    <div className="grid grid-cols-6 gap-2">
                                        {habitColors.map(color => (
                                            <button key={color.value} type="button" onClick={() => setEditForm({...editForm, color: color.value})} className={`w-full aspect-square rounded-lg transition-all ${editForm.color === color.value ? 'ring-2 ring-offset-2 ring-blue-500 scale-110' : ''}`} style={{backgroundColor: color.value}} />
                                        ))}
                                    </div>
                                </div>

                                <button onClick={saveEditHabit} className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-medium text-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                            </div>
                        </div>
                    )}

                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-[100]">
                            <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-t-3xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-bold">–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞</h3>
                                    <button onClick={() => setShowAddForm(false)} className="p-2"><div className="w-6 h-6"><X /></div></button>
                                </div>

                                <input type="text" value={newHabit.name} onChange={(e) => setNewHabit({...newHabit, name: e.target.value})} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏" className={`w-full px-4 py-3 rounded-xl mb-4 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} autoFocus />
                                <select value={newHabit.category} onChange={(e) => setNewHabit({...newHabit, category: e.target.value})} className={`w-full px-4 py-3 rounded-xl mb-4 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`}>
                                    {categories.map(cat => <option key={cat} value={cat}>{categoryIcons[cat]} {cat}</option>)}
                                </select>

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏ *</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button type="button" onClick={() => setNewHabit({...newHabit, metricType: 'check', targetValue: 1})} className={`p-3 rounded-xl text-center transition-all ${newHabit.metricType === 'check' ? 'bg-slate-600 ring-2 ring-slate-400' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                            <div className="text-2xl mb-1">‚úì</div><div className="text-sm">–ì–∞–ª–æ—á–∫–∞</div>
                                        </button>
                                        <button type="button" onClick={() => setNewHabit({...newHabit, metricType: 'count', targetValue: 8})} className={`p-3 rounded-xl text-center transition-all ${newHabit.metricType === 'count' ? 'bg-slate-600 ring-2 ring-slate-400' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                            <div className="text-2xl mb-1">üî¢</div><div className="text-sm">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                        </button>
                                        <button type="button" onClick={() => setNewHabit({...newHabit, metricType: 'time', targetValue: 30})} className={`p-3 rounded-xl text-center transition-all ${newHabit.metricType === 'time' ? 'bg-slate-600 ring-2 ring-slate-400' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                            <div className="text-2xl mb-1">‚è±Ô∏è</div><div className="text-sm">–í—Ä–µ–º—è (–º–∏–Ω)</div>
                                        </button>
                                        <button type="button" onClick={() => setNewHabit({...newHabit, metricType: 'distance', targetValue: 5})} className={`p-3 rounded-xl text-center transition-all ${newHabit.metricType === 'distance' ? 'bg-slate-600 ring-2 ring-slate-400' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>
                                            <div className="text-2xl mb-1">üìè</div><div className="text-sm">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</div>
                                        </button>
                                    </div>
                                </div>

                                {newHabit.metricType !== 'check' && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
                                        <input type="number" value={newHabit.targetValue} onChange={(e) => setNewHabit({...newHabit, targetValue: Number(e.target.value)})} min="1" className={`w-full px-4 py-3 rounded-xl ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} />
                                        {newHabit.metricType === 'count' && (
                                            <input type="text" value={newHabit.unit} onChange={(e) => setNewHabit({...newHabit, unit: e.target.value})} placeholder="–ï–¥–∏–Ω–∏—Ü–∞ (—Å—Ç–∞–∫–∞–Ω–æ–≤, —Ä–∞–∑...)" className={`w-full px-4 py-3 rounded-xl mt-2 ${isDark ? 'bg-gray-700' : 'bg-gray-100'} outline-none`} />
                                        )}
                                    </div>
                                )}

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ *</label>
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setNewHabit({...newHabit, frequency: 'daily', selectedDays: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']})} className={`flex-1 py-3 rounded-xl transition-all ${newHabit.frequency === 'daily' ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</button>
                                        <button type="button" onClick={() => setNewHabit({...newHabit, frequency: 'weekly'})} className={`flex-1 py-3 rounded-xl transition-all ${newHabit.frequency === 'weekly' ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>–í—ã–±—Ä–∞—Ç—å –¥–Ω–∏</button>
                                    </div>
                                </div>

                                {newHabit.frequency === 'weekly' && (
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">–î–Ω–∏ –Ω–µ–¥–µ–ª–∏</label>
                                        <div className="flex gap-2">
                                            {weekDays.map(day => (
                                                <button key={day} type="button" onClick={() => toggleDay(day)} className={`flex-1 py-2 rounded-lg transition-all ${newHabit.selectedDays.includes(day) ? 'bg-blue-600' : isDark ? 'bg-gray-700' : 'bg-gray-200'}`}>{day}</button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">–¶–≤–µ—Ç</label>
                                    <div className="grid grid-cols-6 gap-2">
                                        {habitColors.map(color => (
                                            <button key={color.value} type="button" onClick={() => setNewHabit({...newHabit, color: color.value})} className={`w-full aspect-square rounded-lg transition-all ${newHabit.color === color.value ? 'ring-2 ring-offset-2 ring-blue-500 scale-110' : ''}`} style={{backgroundColor: color.value}} />
                                        ))}
                                    </div>
                                </div>

                                <button onClick={addHabit} className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-medium">–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
                            </div>
                        </div>
                    )}

                    {/* Main Content */}
                    <div className="px-3 sm:px-4 py-3 sm:py-4 pb-20 sm:pb-24">
                        <div className="mb-3 sm:mb-4">
                            <h2 className="text-xl sm:text-2xl font-bold mb-1">–ü—Ä–∏–≤–µ—Ç! üëã</h2>
                            <p className="text-xs sm:text-sm text-gray-400">–ü—Ä–∏–≤—ã—á–µ–∫: {habits.length}</p>
                        </div>

                        {habits.length === 0 ? (
                            <div className="text-center py-12">
                                <div className="text-6xl mb-4">üìù</div>
                                <p className="text-gray-400 text-lg mb-2">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫</p>
                                <p className="text-gray-500 text-sm">–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é</p>
                            </div>
                        ) : (
                            <div className="space-y-2 sm:space-y-3">
                                {habits.map(habit => {
                                    const isExpanded = expandedHabit === habit.id;
                                    const todayCompletion = getTodayCompletion(habit);
                                    
                                    return (
                                        <div key={habit.id} className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl overflow-hidden`} style={{borderLeft: `4px solid ${habit.color}`}}>
                                            <div className="p-3 sm:p-4">
                                                <div className="flex items-start gap-2 sm:gap-3 mb-2 sm:mb-3">
                                                    <div className="text-2xl sm:text-3xl">{categoryIcons[habit.category]}</div>
                                                    <div className="flex-1 min-w-0">
                                                        <h4 className="habit-name font-semibold mb-1">{habit.name}</h4>
                                                        <p className="text-xs text-gray-400">
                                                            {habit.category}
                                                            {habit.metricType !== 'check' && ` ‚Ä¢ –¶–µ–ª—å: ${habit.targetValue} ${getUnitLabel(habit)}`}
                                                        </p>
                                                        {todayCompletion && (
                                                            <p className="text-xs text-green-400 mt-1">
                                                                ‚úì –°–µ–≥–æ–¥–Ω—è –≤ {todayCompletion.time}
                                                                {habit.metricType !== 'check' && ` ‚Ä¢ ${todayCompletion.value}/${habit.targetValue} (${todayCompletion.percentage}%)`}
                                                            </p>
                                                        )}
                                                    </div>
                                                    <div className="flex gap-1 sm:gap-2">
                                                        <button onClick={() => openEditModal(habit)} className="text-gray-400 hover:text-blue-500 p-1.5 sm:p-3 -m-1 sm:-m-2 transition-colors active:scale-95">
                                                            <div className="w-5 h-5 sm:w-6 sm:h-6">
                                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                                            </div>
                                                        </button>
                                                        <button onClick={() => setConfirmDelete(habit.id)} className="text-gray-400 hover:text-red-500 p-1.5 sm:p-3 -m-1 sm:-m-2 transition-colors active:scale-95">
                                                            <div className="w-5 h-5 sm:w-6 sm:h-6"><Trash2 /></div>
                                                        </button>
                                                    </div>
                                                </div>

                                                {habit.metricType !== 'check' && todayCompletion && (
                                                    <div className={`w-full ${isDark ? 'bg-gray-700' : 'bg-gray-200'} rounded-full h-2 mb-3 sm:mb-4`}>
                                                        <div className="h-2 rounded-full transition-all duration-500" style={{width: `${Math.min(todayCompletion.percentage, 100)}%`, backgroundColor: habit.color}} />
                                                    </div>
                                                )}

                                                <div className="flex gap-2">
                                                    {todayCompletion ? (
                                                        <>
                                                            <button onClick={() => openCompletionModal(habit)} className="flex-1 py-2.5 sm:py-3 rounded-xl font-medium text-xs sm:text-sm transition-all flex items-center justify-center bg-blue-600 text-white active:scale-95">
                                                                –ò–∑–º–µ–Ω–∏—Ç—å
                                                            </button>
                                                            <button onClick={() => cancelCompletion(habit.id)} className="flex-1 py-2.5 sm:py-3 rounded-xl font-medium text-xs sm:text-sm transition-all flex items-center justify-center bg-red-600 text-white active:scale-95">
                                                                –û—Ç–º–µ–Ω–∏—Ç—å
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <button onClick={() => openCompletionModal(habit)} className="flex-1 py-2.5 sm:py-3 rounded-xl font-medium text-xs sm:text-sm transition-all flex items-center justify-center gap-1.5 sm:gap-2 text-white active:scale-95" style={{backgroundColor: habit.color}}>
                                                            <div className="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"><Target /></div>
                                                            <span>–û—Ç–º–µ—Ç–∏—Ç—å</span>
                                                        </button>
                                                    )}
                                                    <button onClick={() => setExpandedHabit(isExpanded ? null : habit.id)} className={`px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl ${isDark ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} transition-colors active:scale-95`}>
                                                        <div className="w-4 h-4"><Calendar /></div>
                                                    </button>
                                                </div>
                                            </div>

                                            {isExpanded && (
                                                <div className={`border-t ${isDark ? 'border-gray-700' : 'border-gray-200'} p-4`}>
                                                    <h5 className="text-sm font-medium mb-3 text-gray-400">{new Date().toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}</h5>
                                                    <div className="grid grid-cols-7 gap-2">
                                                        {monthDays.map((day, idx) => {
                                                            const dayCompletion = getCompletionOnDate(habit, day);
                                                            const isToday = day.toDateString() === new Date().toDateString();
                                                            
                                                            return (
                                                                <div key={idx} className={`aspect-square rounded-lg flex flex-col items-center justify-center text-sm font-medium ${isToday ? 'ring-2' : ''}`} style={{backgroundColor: dayCompletion ? habit.color : (isDark ? '#374151' : '#e5e7eb'), color: dayCompletion ? 'white' : undefined, borderColor: isToday ? habit.color : undefined}}>
                                                                    <div>{day.getDate()}</div>
                                                                    {dayCompletion && dayCompletion.time && <div className="text-[9px] opacity-75 mt-0.5">{dayCompletion.time}</div>}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>

                    <button onClick={() => setShowAddForm(true)} className="fixed right-4 sm:right-5 bottom-4 sm:bottom-5 w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-95 transition-transform z-40">
                        <div className="w-7 h-7 sm:w-8 sm:h-8"><Plus /></div>
                    </button>
                </div>
            );
        }

        ReactDOM.render(<HabitTracker />, document.getElementById('root'));
    </script>
</body>
</html>
